/*! webperf - v1.0.0 - 2015-03-21
* https://github.com/gmoon/epicbattles
* Copyright (c) 2015 George Moon; Licensed Apache 2.0 */

var documentDomainError;angular.module("webPerformanceApp",["ngSanitize"]).directive("sbLoad",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.sbLoad);c.on("load",function(a){b.$apply(function(){e(b,{$event:a})})})}}}]).filter("percentage",["$window",function(a){return function(b,c,d){return c=angular.isNumber(c)?c:0,d=d||"%",a.isNaN(b)?"":Math.round(b*Math.pow(10,c+2))/Math.pow(10,c)+d}}]).filter("abs",[function(){return function(a){return Math.abs(a)}}]).controller("WebPerformanceController",["$sce","$scope","$interval",function(a,b,c){b.stages=["total","redirect","appCache","dns","tcp","ssl","request","response","processing","onLoad"],b.metrics=["min","max","avg","stdev","current","count","sum"],b.visibleMetrics=["current","min","avg","max"],b.errors=[],b.errorsLookup={},b.battle={samplingInterval:1e4,headline:"When serving the same TodoMVC app...",scoring:{stage:"total",metric:"current"},contestants:[{headlineLabel:"TodoMVC AngularJS",url:a.trustAsResourceUrl("http://gmoon.github.io/todomvc/examples/angularjs/"),id:"angularjs",label:"AngularJS",labelCaption:"angular"},{headlineLabel:"TodoMVC EmberJS",url:a.trustAsResourceUrl("http://gmoon.github.io/todomvc/examples/emberjs/"),id:"emberjs",label:"EmberJS",labelCaption:"ember"}],left:void 0,right:void 0};var d;b.initMetrics=function(a,b){var c=a.reduce(function(a,c){var d=b.reduce(function(a,b){return a[b]="min"===b?1e6:0,a},{});return a[c]=d,a},{});return c},b.onIframeLoad=function(a){b.processIframeLoad(a.currentTarget.id,a.currentTarget)},b.processIframeLoad=function(a,c){var d=c.contentWindow.performance.timing,e=d.navigationStart,f=d.redirectEnd-d.redirectStart,g=d.domainLookupStart-d.fetchStart,h=d.domainLookupEnd-d.domainLookupStart,i=d.connectEnd-d.connectStart,j=d.secureConnectionStart>0?d.connectEnd-d.secureConnectionStart:0,k=d.responseStart-d.requestStart,l=d.responseEnd-d.responseStart,m=d.loadEventStart-d.domLoading,n=d.loadEventEnd-d.loadEventStart,o=d.loadEventEnd-e;b.setMetric(a,"redirect",f),b.setMetric(a,"appCache",g),b.setMetric(a,"dns",h),b.setMetric(a,"tcp",i),b.setMetric(a,"ssl",j),b.setMetric(a,"request",k),b.setMetric(a,"response",l),b.setMetric(a,"processing",m),b.setMetric(a,"onLoad",n),b.setMetric(a,"total",o),b.stats[b.battle.left.id].total.count===b.stats[b.battle.right.id].total.count&&b.recalcPercentage()},b.setMetric=function(a,c,d){var e=b.stats[a][c];e.current=d,e.count++,e.sum+=d,e.max=d>e.max?d:e.max,e.min=d<e.min?d:e.min,e.avg=Math.floor(e.sum/e.count)},b.fight=function(){angular.isDefined(d)||(d=c(function(){try{b.battle.contestants.forEach(function(a){$("#"+a.id)[0].contentWindow.location.reload()})}catch(a){b.addError(a)}},b.battle.samplingInterval))},b.recalcPercentage=function(){var a=b.stats[b.battle.left.id].total.current,c=b.stats[b.battle.right.id].total.current;b.pctSlower=(c-a)/a},b.stopFight=function(){angular.isDefined(d)&&(c.cancel(d),d=void 0)},b.isStarted=function(){return angular.isDefined(d)?!0:!1},b.toggleFight=function(){angular.isDefined(d)?b.stopFight():b.fight()},b.resetFight=function(){b.pctSlower=0,b.stats={},b.battle.contestants.forEach(function(a){b.stats[a.id]=b.initMetrics(b.stages,b.metrics)})},b.clearErrorMessage=function(a){b.errors.splice(a,1)},b.addError=function(a){var c=$.grep(b.errors,function(b){return b.message===a.toString()});0===c.length?b.errors.push({message:a.toString(),count:1}):c[0].count++},b.promoteFighter=function(a,c){b.battle[a]=b.battle.contestants[c],b.recalcPercentage()},angular.isDefined(documentDomainError)&&b.addError(documentDomainError),b.battle.left=b.battle.contestants[0],b.battle.right=b.battle.contestants[1],b.resetFight(),b.fight()}]);
//# sourceMappingURL=webperf.min.js.map